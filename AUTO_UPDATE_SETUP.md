# Налаштування Автоматичного Оновлення LUMYN

## Як працює автоматичне оновлення

LUMYN використовує `electron-updater` для автоматичної перевірки нових версій на GitHub Releases. Коли ви запускаєте додаток:

1. **Через 3 секунди** після запуску додаток автоматично перевіряє наявність оновлень
2. Якщо знайдено нову версію, з'являється **зелена крапка** на кнопці оновлення
3. Натискаючи кнопку, користувач **завантажує** оновлення
4. Після завантаження кнопка пропонує **перезапустити** додаток
5. Додаток встановлює оновлення та перезапускається

## Конфігурація (вже налаштовано)

### package.json
```json
"build": {
  "publish": [
    {
      "provider": "github",
      "owner": "user4032",
      "repo": "LUMYN"
    }
  ]
}
```

### main.js
- Автоматична перевірка оновлень при запуску
- Логування в консоль та файл
- Ручне завантаження (користувач контролює трафік)
- Автовстановлення при виході з додатка

## Як опублікувати реліз на GitHub

### Крок 1: Збудуйте інсталятор

```bash
npm run build:desktop -- --win
```

Це створить файл `release/LUMYN Setup 1.0.11.exe`

### Крок 2: Створіть Git Tag

```bash
git add .
git commit -m "Release v1.0.11"
git tag v1.0.11
git push origin main
git push origin v1.0.11
```

**ВАЖЛИВО:** Версія в тегу (`v1.0.11`) має відповідати версії в `package.json`

### Крок 3: Створіть GitHub Release

1. Перейдіть на https://github.com/user4032/LUMYN/releases
2. Натисніть **"Draft a new release"**
3. Виберіть тег: **v1.0.11**
4. Назва релізу: **LUMYN v1.0.11 - Bug Fixes and UX Improvements**
5. Опис: Скопіюйте з файлу `RELEASE_1.0.11.md`
6. Завантажте файли:
   - `LUMYN Setup 1.0.11.exe` (основний інсталятор)
   - `LUMYN Setup 1.0.11.exe.blockmap` (для диференціальних оновлень)
   - `latest.yml` (файл метаданих для electron-updater)

### Крок 4: Опублікуйте Release

Натисніть **"Publish release"**

## latest.yml файл

Цей файл автоматично генерується під час збірки. Знаходиться в `release/latest.yml`:

```yaml
version: 1.0.11
files:
  - url: LUMYN Setup 1.0.11.exe
    sha512: [автоматично генерується]
    size: 89965061
path: LUMYN Setup 1.0.11.exe
sha512: [автоматично генерується]
releaseDate: '2026-02-16T00:29:27.000Z'
```

**ВАЖЛИВО:** Завантажуйте `latest.yml` на GitHub разом з .exe файлом!

## Тестування автоматичного оновлення

### Тест 1: Перевірка оновлень
1. Запустіть LUMYN v1.0.10 (стару версію)
2. Зачекайте 3 секунди
3. На кнопці оновлення має з'явитися зелена крапка
4. Підказка покаже: "Update available"

### Тест 2: Завантаження оновлення
1. Натисніть кнопку оновлення
2. Статус зміниться на "Downloading update..."
3. Прогрес буде відображатися в консолі
4. Після завантаження: "Restart to update"

### Тест 3: Встановлення
1. Натисніть "Restart to update"
2. Додаток закриється
3. Оновлення встановиться автоматично
4. Додаток запуститься із версією 1.0.11

## Логи для діагностики

Файли логів зберігаються в:
- **Windows:** `%USERPROFILE%\AppData\Roaming\LUMYN\logs\main.log`
- **macOS:** `~/Library/Logs/LUMYN/main.log`
- **Linux:** `~/.config/LUMYN/logs/main.log`

Лог містить:
```
[2026-02-16 00:30:15] Checking for updates...
[2026-02-16 00:30:16] Update available: 1.0.11
[2026-02-16 00:30:20] Download progress: 25%
[2026-02-16 00:30:25] Download progress: 50%
[2026-02-16 00:30:30] Download progress: 100%
[2026-02-16 00:30:31] Update downloaded: 1.0.11
```

## Диференціальні оновлення

electron-updater підтримує диференціальні оновлення через `.blockmap` файли:
- Замість завантаження повного 90MB файлу
- Завантажуються лише змінені блоки (зазвичай 5-20MB)
- Економить трафік користувачів
- Швидше завантаження

**Важливо:** Завжди завантажуйте `.exe.blockmap` файл на GitHub!

## Troubleshooting

### Оновлення не знайдено
- Перевірте, чи тег на GitHub відповідає версії в package.json
- Переконайтесь, що `latest.yml` завантажений на GitHub
- Перевірте логи: "Update error: ..."

### Помилка завантаження
- Перевірте інтернет-з'єднання
- GitHub releases має бути публічним
- Файл .exe має бути доступний для завантаження

### Оновлення не встановлюється
- Windows Defender може блокувати
- Запустіть LUMYN від імені адміністратора
- Перевірте права доступу до папки Program Files

## Альтернативні провайдери

Замість GitHub можна використовувати:

### S3 Bucket
```json
"publish": {
  "provider": "s3",
  "bucket": "your-bucket"
}
```

### Generic Server
```json
"publish": {
  "provider": "generic",
  "url": "https://your-domain.com/updates"
}
```

## Безпека

- Всі файли оновлень підписані SHA512 checksums
- electron-updater перевіряє цілісність перед встановленням
- HTTPS обов'язковий для завантаження
- Можна додати code signing для Windows (вимагає сертифіката)

## Наступні кроки

1. ✅ Конфігурація налаштована
2. ✅ electron-log встановлений
3. ✅ Логування активовано
4. ⏳ Опублікуйте реліз на GitHub (слідуйте інструкції вище)
5. ⏳ Протестуйте автоматичне оновлення

**Готово! Автоматичне оновлення налаштовано та готове до використання.**
